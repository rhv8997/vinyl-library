<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Vinyl Library</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050508;
      color: #f5f5f5;
    }

    body {
      margin: 0;
      padding: 16px;
      max-width: 960px;
      margin-inline: auto;
    }

    header {
      text-align: center;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0;
      font-size: 1.9rem;
    }

    p.subtitle {
      margin: 8px 0 0;
      font-size: 0.9rem;
      opacity: 0.75;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 16px 0 18px;
    }

    .search-box {
      max-width: 420px;
      margin-inline: auto;
    }

    .search-input {
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid #333;
      background: #111118;
      color: inherit;
      font-size: 0.95rem;
      box-sizing: border-box;
    }

    .search-input:focus {
      outline: none;
      border-color: #1db954;
    }

    .actions-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
    }

    .button-primary {
      background: #1db954;
      color: #050508;
    }

    .button-ghost {
      background: transparent;
      border: 1px solid #333;
      color: #f5f5f5;
    }

    .button:active {
      transform: scale(0.96);
    }

    /* GRID */
    .vinyl-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 14px;
      padding: 4px 0 20px;
    }

    .vinyl-card {
      background: #111118;
      border-radius: 14px;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 8px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      cursor: pointer;
    }

    .vinyl-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
      background: #15151f;
    }

    .cover-wrap {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      aspect-ratio: 1 / 1;
      background: #222;
    }

    .cover-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .cover-badge {
      position: absolute;
      left: 8px;
      bottom: 8px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.65);
      font-size: 0.7rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .cover-badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #1db954;
    }

    .vinyl-meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-height: 44px;
    }

    .vinyl-title {
      font-size: 0.9rem;
      font-weight: 600;
      line-height: 1.2;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .vinyl-artist {
      font-size: 0.8rem;
      opacity: 0.7;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 2px;
    }

    .empty-state {
      margin-top: 40px;
      text-align: center;
      opacity: 0.7;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>My Vinyl Library</h1>
    <p class="subtitle">Tap an album to play it on Spotify.</p>
  </header>

  <section class="controls">
    <div class="search-box">
      <input
        id="search"
        class="search-input"
        type="text"
        placeholder="Search by title or artist..."
        autocomplete="off"
      />
    </div>

    <div class="actions-row">
      <button id="random-btn" class="button button-primary">ðŸŽ² Random album</button>
    </div>
  </section>

  <div id="vinyl-grid" class="vinyl-grid"></div>

  <p id="empty-state" class="empty-state" style="display:none;">
    No vinyls found. Try a different search.
  </p>

  <script>
    /**
     * HARD-CODED VINYL LIST
     *
     * When you send me your albums, Iâ€™ll fill this out for you.
     * For now, these are just example entries.
     */
    const VINYLS = [
      {
        title: "Random Access Memories",
        artist: "Daft Punk",
        spotifyUrl: "https://open.spotify.com/album/4m2880jivSbbyEGAKfITCa",
        coverUrl: null
      },
      {
        title: "Rumours",
        artist: "Fleetwood Mac",
        spotifyUrl: "https://open.spotify.com/album/1bt6q2SruMsBtcerNVtpZB",
        coverUrl: null
      },
      {
        title: "Abbey Road",
        artist: "The Beatles",
        spotifyUrl: "https://open.spotify.com/album/0ETFjACtuP2ADo6LFhL6HN",
        coverUrl: null
      }
    ];

    const gridEl = document.getElementById("vinyl-grid");
    const searchInputEl = document.getElementById("search");
    const emptyStateEl = document.getElementById("empty-state");
    const randomBtnEl = document.getElementById("random-btn");

    const PLACEHOLDER_SVG =
      "data:image/svg+xml;charset=utf-8," +
      encodeURIComponent(
        '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><rect width="300" height="300" fill="#222"/><circle cx="150" cy="150" r="90" fill="#111"/><circle cx="150" cy="150" r="12" fill="#555"/></svg>'
      );

    function openSpotify(url) {
      // This will usually deep-link into the Spotify app on mobile
      window.location.href = url;
    }

    // Get cover art from Spotify oEmbed, then cache on the vinyl object
    async function fetchCoverFor(vinyl, imgEl) {
      if (vinyl.coverUrl) {
        imgEl.src = vinyl.coverUrl;
        return;
      }
      try {
        const oembedUrl =
          "https://open.spotify.com/oembed?url=" + encodeURIComponent(vinyl.spotifyUrl);
        const res = await fetch(oembedUrl);
        if (!res.ok) throw new Error("oEmbed failed");
        const data = await res.json();
        vinyl.coverUrl = data.thumbnail_url || PLACEHOLDER_SVG;
        imgEl.src = vinyl.coverUrl;
      } catch (err) {
        console.error("Error fetching cover:", err);
        imgEl.src = PLACEHOLDER_SVG;
      }
    }

    function getFilteredVinyls(queryText) {
      const query = (queryText || "").trim().toLowerCase();
      if (!query) return VINYLS;
      return VINYLS.filter(v => {
        const t = (v.title || "").toLowerCase();
        const a = (v.artist || "").toLowerCase();
        return t.includes(query) || a.includes(query);
      });
    }

    function renderGrid(filterText = "") {
      gridEl.innerHTML = "";

      const filtered = getFilteredVinyls(filterText);

      if (filtered.length === 0) {
        emptyStateEl.style.display = "block";
        return;
      } else {
        emptyStateEl.style.display = "none";
      }

      filtered.forEach(vinyl => {
        const card = document.createElement("div");
        card.className = "vinyl-card";
        card.addEventListener("click", () => openSpotify(vinyl.spotifyUrl));

        const coverWrap = document.createElement("div");
        coverWrap.className = "cover-wrap";

        const img = document.createElement("img");
        img.alt = `${vinyl.title || "Album"} cover`;
        img.src = vinyl.coverUrl || PLACEHOLDER_SVG;
        coverWrap.appendChild(img);

        // Kick off async cover fetch (if not already loaded)
        if (!vinyl.coverUrl) {
          fetchCoverFor(vinyl, img);
        }

        const badge = document.createElement("div");
        badge.className = "cover-badge";
        badge.innerHTML =
          '<span class="cover-badge-dot"></span><span>Spotify</span>';
        coverWrap.appendChild(badge);

        const meta = document.createElement("div");
        meta.className = "vinyl-meta";

        const titleEl = document.createElement("div");
        titleEl.className = "vinyl-title";
        titleEl.textContent = vinyl.title || "Untitled album";

        const artistEl = document.createElement("div");
        artistEl.className = "vinyl-artist";
        artistEl.textContent = vinyl.artist || "â€”";

        meta.appendChild(titleEl);
        meta.appendChild(artistEl);

        const footer = document.createElement("div");
        footer.className = "card-footer";
        // (footer kept minimal for now; we could add year/info later)

        card.appendChild(coverWrap);
        card.appendChild(meta);
        card.appendChild(footer);

        gridEl.appendChild(card);
      });
    }

    // Search
    searchInputEl.addEventListener("input", e => {
      renderGrid(e.target.value);
    });

    // Random album button
    randomBtnEl.addEventListener("click", () => {
      const filterText = searchInputEl.value;
      const pool = getFilteredVinyls(filterText);
      if (!pool.length) return;
      const randomIndex = Math.floor(Math.random() * pool.length);
      const chosen = pool[randomIndex];
      openSpotify(chosen.spotifyUrl);
    });

    // Initial render
    renderGrid();
  </script>
</body>
</html>
